<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Attendance Portal</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        theme: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            500: '#6366f1', // Indigo
                            600: '#4f46e5',
                            700: '#4338ca',
                        }
                    }
                }
            }
        }
    </script>

    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- QR Code Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        body {
            background-color: #f8fafc;
            color: #1e293b;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS (Inline SVGs for portability) ---
        const Icons = {
            User: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>,
            Lock: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></svg>,
            LogOut: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" y1="12" x2="9" y2="12" /></svg>,
            QrCode: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="14" y="14" width="7" height="7" /><rect x="3" y="14" width="7" height="7" /></svg>,
            Users: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M23 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></svg>,
            BookOpen: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></svg>,
            Plus: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>,
            Trash2: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></svg>,
            ShieldCheck: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /><path d="m9 12 2 2 4-4" /></svg>,
            Play: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3" /></svg>,
            StopCircle: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10" /><rect x="9" y="9" width="6" height="6" /></svg>,
            Check: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12" /></svg>,
            X: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>,
            CheckCircle: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></svg>,
            XCircle: ({ size = 20, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10" /><line x1="15" y1="9" x2="9" y2="15" /><line x1="9" y1="9" x2="15" y2="15" /></svg>,
        };

        // --- MOCK DATABASE (LocalStorage) ---
        const DB = {
            init: () => {
                if (!localStorage.getItem('gvp_users')) {
                    const defaultUsers = [
                        { id: 'admin', username: 'admin', password: '123', role: 'teacher', name: 'Admin Staff' },
                        { id: 's1', username: 'student1', password: '123', role: 'student', rollNo: '101', name: 'Raju Rastogi' },
                        { id: 's2', username: 'student2', password: '123', role: 'student', rollNo: '102', name: 'Farhan Qureshi' },
                    ];
                    localStorage.setItem('gvp_users', JSON.stringify(defaultUsers));
                }
                if (!localStorage.getItem('gvp_students_data')) {
                    const defaultStudents = [
                        { name: 'Raju Rastogi', rollNo: '101', sem: '4', subject: 'CS', totalLectures: 10, attendedLectures: 8, marks: 85 },
                        { name: 'Farhan Qureshi', rollNo: '102', sem: '4', subject: 'CS', totalLectures: 10, attendedLectures: 4, marks: 60 },
                    ];
                    localStorage.setItem('gvp_students_data', JSON.stringify(defaultStudents));
                }
            },
            login: (identifier, password) => {
                const users = JSON.parse(localStorage.getItem('gvp_users') || '[]');
                return users.find(u => (u.username === identifier || u.rollNo === identifier) && u.password === password) || null;
            },
            register: (username, password, role, extra) => {
                const users = JSON.parse(localStorage.getItem('gvp_users') || '[]');
                if (users.find(u => u.username === username)) return { success: false, message: 'User exists' };
                const newUser = { id: Date.now().toString(), username, password, role, ...extra };
                users.push(newUser);
                localStorage.setItem('gvp_users', JSON.stringify(users));

                if (role === 'student') {
                    const students = JSON.parse(localStorage.getItem('gvp_students_data') || '[]');
                    if (!students.find(s => s.rollNo === extra.rollNo)) {
                        students.push({
                            name: extra.name || username,
                            rollNo: extra.rollNo,
                            sem: extra.sem || '1',
                            subject: extra.subject || 'General',
                            totalLectures: 0,
                            attendedLectures: 0
                        });
                        localStorage.setItem('gvp_students_data', JSON.stringify(students));
                    }
                }
                return { success: true, user: newUser };
            },
            getStudents: () => JSON.parse(localStorage.getItem('gvp_students_data') || '[]'),
            addStudent: (data) => {
                const list = DB.getStudents();
                if (list.find(s => s.rollNo === data.rollNo)) return false;
                list.push({ ...data, totalLectures: 0, attendedLectures: 0 });
                localStorage.setItem('gvp_students_data', JSON.stringify(list));
                return true;
            },
            deleteStudent: (rollNo) => {
                const list = DB.getStudents().filter(s => s.rollNo !== rollNo);
                localStorage.setItem('gvp_students_data', JSON.stringify(list));
            },
            createSession: (tid, sub) => {
                const list = JSON.parse(localStorage.getItem('gvp_sessions') || '[]');
                const code = Math.random().toString(36).substring(2, 7).toUpperCase();
                const session = { id: Date.now().toString(), code, teacherId: tid, subject: sub, active: true };
                list.push(session);
                localStorage.setItem('gvp_sessions', JSON.stringify(list));
                return session;
            },
            getActiveSession: () => {
                const list = JSON.parse(localStorage.getItem('gvp_sessions') || '[]');
                return list.find(s => s.active) || null;
            },
            closeSession: (id) => {
                const list = JSON.parse(localStorage.getItem('gvp_sessions') || '[]');
                const idx = list.findIndex(s => s.id === id);
                if (idx !== -1) {
                    list[idx].active = false;
                    localStorage.setItem('gvp_sessions', JSON.stringify(list));
                }
            },
            markAttendance: (rollNo, code) => {
                const sessions = JSON.parse(localStorage.getItem('gvp_sessions') || '[]');
                const session = sessions.find(s => s.code === code && s.active);
                if (!session) return { success: false, message: 'Invalid/Closed Session' };

                const logs = JSON.parse(localStorage.getItem('gvp_logs') || '[]');
                if (logs.find(l => l.rollNo === rollNo && l.sessionId === session.id)) return { success: false, message: 'Already marked!' };

                logs.push({ rollNo, sessionId: session.id, time: new Date().toISOString() });
                localStorage.setItem('gvp_logs', JSON.stringify(logs));

                const students = DB.getStudents();
                const sIdx = students.findIndex(s => s.rollNo === rollNo);
                if (sIdx !== -1) {
                    students[sIdx].attendedLectures += 1;
                    localStorage.setItem('gvp_students_data', JSON.stringify(students));
                }
                return { success: true, message: 'Marked Present!' };
            }
        };

        // Initialize DB
        DB.init();

        // --- COMPONENTS ---

        const QRCodeView = ({ value }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (ref.current) {
                    ref.current.innerHTML = '';
                    new QRCode(ref.current, {
                        text: value,
                        width: 180,
                        height: 180,
                    });
                }
            }, [value]);
            return <div ref={ref} className="bg-white p-2 inline-block"></div>;
        };

        const Auth = ({ onLogin }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [role, setRole] = useState('student');
            const [formData, setFormData] = useState({ username: '', password: '', name: '', rollNo: '', sem: '1' });
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                if (isLogin) {
                    const user = DB.login(formData.username, formData.password);
                    if (user) {
                        if (user.role !== role) return setError(`Switch to ${user.role} tab.`);
                        onLogin(user);
                    } else setError("Invalid Credentials");
                } else {
                    if (role === 'teacher') return setError("Teacher signup disabled.");
                    const res = DB.register(formData.rollNo, formData.password, 'student', {
                        name: formData.name, rollNo: formData.rollNo, sem: formData.sem
                    });
                    if (res.success) onLogin(res.user); else setError(res.message);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col md:flex-row border border-slate-100">
                        <div className="hidden md:flex md:w-1/2 bg-gradient-to-br from-indigo-700 to-indigo-900 p-12 flex-col justify-between text-white relative overflow-hidden">
                            <div className="relative z-10">
                                <div className="flex items-center gap-2 mb-2 bg-white/10 w-fit px-3 py-1 rounded-full"><Icons.ShieldCheck size={16} /> Secure Portal</div>
                                <h2 className="text-3xl font-bold mb-4">Classroom Management Reimagined.</h2>
                                <p className="opacity-80">Streamlined attendance tracking for the modern campus.</p>
                            </div>
                            <div className="absolute top-0 right-0 -mr-20 -mt-20 w-80 h-80 bg-white/5 rounded-full blur-3xl"></div>
                        </div>
                        <div className="flex-1 p-8 md:p-12 flex flex-col justify-center bg-white">
                            <div className="mb-6">
                                <h1 className="text-2xl font-bold text-slate-800">{isLogin ? 'Welcome Back' : 'Get Started'}</h1>
                                <p className="text-slate-500 text-sm">{isLogin ? 'Login to continue' : 'Create a new account'}</p>
                            </div>

                            <div className="flex p-1 bg-slate-100 rounded-lg mb-6">
                                {['student', 'teacher'].map(r => (
                                    <button key={r} onClick={() => setRole(r)} className={`flex-1 py-2 text-sm font-medium rounded-md capitalize transition-all ${role === r ? 'bg-white shadow text-indigo-600' : 'text-slate-500'}`}>
                                        {r}
                                    </button>
                                ))}
                            </div>

                            <form onSubmit={handleSubmit} className="space-y-4">
                                {!isLogin && role === 'student' && (
                                    <div className="grid grid-cols-2 gap-3">
                                        <input className="px-4 py-2 border rounded-lg w-full" placeholder="Name" value={formData.name} onChange={e => setFormData({ ...formData, name: e.target.value })} required />
                                        <input className="px-4 py-2 border rounded-lg w-full" placeholder="Sem" value={formData.sem} onChange={e => setFormData({ ...formData, sem: e.target.value })} required />
                                    </div>
                                )}
                                <div>
                                    <label className="text-xs font-bold text-slate-500 uppercase">{role === 'student' ? 'Roll No / Username' : 'Username'}</label>
                                    <input className="px-4 py-2 border rounded-lg w-full mt-1" placeholder={role === 'student' ? "e.g. 101" : "admin"} value={isLogin ? formData.username : (role === 'student' ? formData.rollNo : formData.username)} onChange={e => setFormData({ ...formData, username: e.target.value, rollNo: !isLogin && role === 'student' ? e.target.value : formData.rollNo })} required />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-slate-500 uppercase">Password</label>
                                    <input type="password" className="px-4 py-2 border rounded-lg w-full mt-1" placeholder="••••••" value={formData.password} onChange={e => setFormData({ ...formData, password: e.target.value })} required />
                                </div>
                                {error && <div className="text-red-500 text-sm bg-red-50 p-2 rounded">{error}</div>}
                                <button className="w-full py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition-colors">
                                    {isLogin ? 'Sign In' : 'Register'}
                                </button>
                            </form>
                            <div className="mt-4 text-center text-sm">
                                <button onClick={() => setIsLogin(!isLogin)} className="text-indigo-600 font-semibold hover:underline">
                                    {isLogin ? 'Create Account' : 'Back to Login'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TeacherDashboard = ({ user, onLogout }) => {
            const [tab, setTab] = useState('session');
            const [students, setStudents] = useState([]);
            const [session, setSession] = useState(null);
            const [newS, setNewS] = useState({ name: '', rollNo: '', sem: 1 });

            const load = () => {
                setStudents(DB.getStudents());
                setSession(DB.getActiveSession());
            };
            useEffect(() => { load(); const i = setInterval(load, 2000); return () => clearInterval(i); }, []);

            const startS = () => { setSession(DB.createSession(user.id, 'General')); };
            const stopS = () => { if (session) { DB.closeSession(session.id); setSession(null); alert('Session Ended'); } };
            const addS = (e) => { e.preventDefault(); if (DB.addStudent(newS)) { setNewS({ name: '', rollNo: '', sem: 1 }); load(); alert('Added'); } else alert('Exists'); };
            const delS = (r) => { if (confirm('Delete?')) { DB.deleteStudent(r); load(); } };

            return (
                <div className="min-h-screen flex flex-col md:flex-row bg-slate-50">
                    <aside className="w-full md:w-64 bg-white border-r border-slate-200 flex-shrink-0 flex flex-col h-screen sticky top-0">
                        <div className="h-16 flex items-center px-6 border-b"><Icons.BookOpen className="text-indigo-600 mr-2" /><span className="font-bold text-lg">ClassManager</span></div>
                        <nav className="p-4 space-y-2 flex-1">
                            <button onClick={() => setTab('session')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium ${tab === 'session' ? 'bg-indigo-50 text-indigo-700' : 'text-slate-600 hover:bg-slate-50'}`}><Icons.QrCode size={18} /> Active Session</button>
                            <button onClick={() => setTab('students')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium ${tab === 'students' ? 'bg-indigo-50 text-indigo-700' : 'text-slate-600 hover:bg-slate-50'}`}><Icons.Users size={18} /> Student List</button>
                        </nav>
                        <div className="p-4 border-t bg-slate-50">
                            <div className="text-sm font-bold truncate">{user.name}</div>
                            <button onClick={onLogout} className="mt-2 w-full flex items-center gap-2 text-red-600 text-sm hover:underline"><Icons.LogOut size={14} /> Sign Out</button>
                        </div>
                    </aside>
                    <main className="flex-1 p-8 overflow-y-auto">
                        <header className="mb-8 flex justify-between items-center">
                            <h1 className="text-2xl font-bold text-slate-800">{tab === 'session' ? 'Attendance' : 'Students'}</h1>
                            <div className="bg-white px-4 py-2 rounded-full border shadow-sm text-sm font-bold text-indigo-600">{students.length} Students</div>
                        </header>

                        {tab === 'session' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div className="bg-white p-8 rounded-xl shadow-sm border border-slate-200 text-center flex flex-col items-center justify-center min-h-[400px]">
                                    {session ? (
                                        <>
                                            <QRCodeView value={session.code} />
                                            <div className="mt-6 text-4xl font-mono font-bold text-slate-800 tracking-wider">{session.code}</div>
                                            <p className="text-sm text-slate-400 mt-2 uppercase tracking-widest">Session Code</p>
                                            <button onClick={stopS} className="mt-8 px-6 py-3 bg-red-50 text-red-600 rounded-lg font-bold hover:bg-red-100 flex items-center gap-2"><Icons.StopCircle size={18} /> Stop Session</button>
                                        </>
                                    ) : (
                                        <>
                                            <div className="w-20 h-20 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-600 mb-6"><Icons.QrCode size={40} /></div>
                                            <h3 className="text-lg font-bold mb-2">No Active Session</h3>
                                            <button onClick={startS} className="px-8 py-3 bg-indigo-600 text-white rounded-full font-bold hover:bg-indigo-700 flex items-center gap-2"><Icons.Play size={18} /> Start Session</button>
                                        </>
                                    )}
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                    <h3 className="font-bold mb-4 flex items-center gap-2"><Icons.CheckCircle size={18} className="text-indigo-500" /> Activity Log</h3>
                                    <div className="text-sm text-slate-500 italic">Recent check-ins will appear here (Simulated)...</div>
                                </div>
                            </div>
                        )}

                        {tab === 'students' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div className="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                    <table className="w-full text-left">
                                        <thead className="bg-slate-50 border-b">
                                            <tr><th className="p-4 text-xs font-bold text-slate-500 uppercase">Student</th><th className="p-4 text-xs font-bold text-slate-500 uppercase">Roll No</th><th className="p-4 text-xs font-bold text-slate-500 uppercase">Attendance</th><th className="p-4 text-right"></th></tr>
                                        </thead>
                                        <tbody className="divide-y">
                                            {students.map(s => {
                                                const pct = s.totalLectures ? Math.round((s.attendedLectures / s.totalLectures) * 100) : 0;
                                                return (
                                                    <tr key={s.rollNo} className="hover:bg-slate-50">
                                                        <td className="p-4 font-medium">{s.name}</td>
                                                        <td className="p-4 font-mono text-sm text-slate-600">{s.rollNo}</td>
                                                        <td className="p-4"><span className={`px-2 py-1 rounded-full text-xs font-bold ${pct < 75 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>{pct}%</span> <span className="text-xs text-slate-400 ml-2">{s.attendedLectures}/{s.totalLectures}</span></td>
                                                        <td className="p-4 text-right"><button onClick={() => delS(s.rollNo)} className="text-slate-400 hover:text-red-600"><Icons.Trash2 size={16} /></button></td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 h-fit">
                                    <h3 className="font-bold mb-4">Add Student</h3>
                                    <form onSubmit={addS} className="space-y-3">
                                        <input className="w-full p-2 border rounded" placeholder="Name" value={newS.name} onChange={e => setNewS({ ...newS, name: e.target.value })} required />
                                        <div className="flex gap-2">
                                            <input className="w-full p-2 border rounded" placeholder="Roll No" value={newS.rollNo} onChange={e => setNewS({ ...newS, rollNo: e.target.value })} required />
                                            <input className="w-full p-2 border rounded" placeholder="Sem" value={newS.sem} onChange={e => setNewS({ ...newS, sem: e.target.value })} required />
                                        </div>
                                        <button className="w-full py-2 bg-indigo-600 text-white rounded font-bold hover:bg-indigo-700">Add</button>
                                    </form>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const StudentDashboard = ({ user, onLogout }) => {
            const [code, setCode] = useState('');
            const [msg, setMsg] = useState(null);
            const [stats, setStats] = useState(null);

            useEffect(() => {
                const load = () => {
                    const list = DB.getStudents();
                    setStats(list.find(s => s.rollNo === user.rollNo));
                };
                load(); const i = setInterval(load, 2500); return () => clearInterval(i);
            }, [user]);

            const mark = (e) => {
                e.preventDefault();
                const res = DB.markAttendance(user.rollNo, code.toUpperCase());
                setMsg(res);
                if (res.success) setCode('');
                setTimeout(() => setMsg(null), 3000);
            };

            if (!stats) return <div className="p-10 text-center">Loading...</div>;
            const pct = stats.totalLectures ? Math.round((stats.attendedLectures / stats.totalLectures) * 100) : 0;

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8">
                    <div className="max-w-4xl mx-auto">
                        <header className="mb-8 flex justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                            <div><h1 className="text-2xl font-bold">Student Portal</h1><p className="text-slate-500 text-sm">Welcome, {user.name}</p></div>
                            <button onClick={onLogout} className="text-sm font-medium text-slate-600 hover:text-red-600 flex items-center gap-2"><Icons.LogOut size={16} /> Logout</button>
                        </header>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center text-center relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
                                <div className="w-16 h-16 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-600 mb-6"><Icons.QrCode size={32} /></div>
                                <h2 className="text-xl font-bold mb-2">Mark Attendance</h2>
                                <p className="text-slate-500 text-sm mb-6">Enter the code displayed by your teacher.</p>
                                <form onSubmit={mark} className="w-full max-w-xs relative">
                                    <input className="w-full text-center text-2xl font-mono p-3 border-2 rounded-xl focus:border-indigo-500 outline-none uppercase tracking-widest" placeholder="CODE" maxLength={5} value={code} onChange={e => setCode(e.target.value)} />
                                    <button disabled={!code} className="w-full mt-4 py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 disabled:opacity-50">Submit</button>
                                </form>
                                {msg && <div className={`mt-4 text-sm font-bold ${msg.success ? 'text-green-600' : 'text-red-600'}`}>{msg.message}</div>}
                            </div>
                            <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 flex flex-col justify-between">
                                <div>
                                    <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">My Stats</h3>
                                    <div className="flex items-baseline gap-2">
                                        <span className={`text-6xl font-black ${pct >= 75 ? 'text-green-600' : 'text-amber-500'}`}>{pct}%</span>
                                        <span className="text-slate-400 font-medium">Attendance</span>
                                    </div>
                                    <div className="w-full bg-slate-100 h-2 rounded-full mt-4 overflow-hidden"><div className={`h-full ${pct >= 75 ? 'bg-green-500' : 'bg-amber-500'}`} style={{ width: `${pct}%` }}></div></div>
                                </div>
                                <div className="grid grid-cols-2 gap-4 mt-8 pt-8 border-t">
                                    <div><div className="text-2xl font-bold">{stats.attendedLectures}</div><div className="text-xs text-slate-400 uppercase font-bold">Attended</div></div>
                                    <div><div className="text-2xl font-bold">{stats.totalLectures}</div><div className="text-xs text-slate-400 uppercase font-bold">Total</div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            useEffect(() => {
                const u = localStorage.getItem('gvp_auth_user');
                if (u) setUser(JSON.parse(u));
            }, []);
            const login = (u) => { setUser(u); localStorage.setItem('gvp_auth_user', JSON.stringify(u)); };
            const logout = () => { setUser(null); localStorage.removeItem('gvp_auth_user'); };

            return user ? (user.role === 'teacher' ? <TeacherDashboard user={user} onLogout={logout} /> : <StudentDashboard user={user} onLogout={logout} />) : <Auth onLogin={login} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>